{% extends "base.html" %}
{% load widget_tweaks %}
{% block content %}

<style>
.profile-avatar-wrapper {
  width: 350px;   /* или любое нужное фиксированное значение */
  height: 350px;
  border-radius: 50%;
  overflow: hidden;
  margin: 0 auto; /* по центру */
}

.profile-avatar {
  width: 100% !important;
  height: 100% !important;
  object-fit: cover;
  border-radius: 0; /* закругление у img убираем, чтобы был ровный круг у контейнера */
}
</style>


<div class="container mt-4" style="max-width: 600px;">
  <h2 class="mb-4">Редактировать профиль</h2>
  <form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <fieldset class="mb-4">
      <legend>Данные пользователя</legend>
      <div class="mb-3">
        <label for="{{ user_form.username.id_for_label }}" class="form-label">Имя пользователя</label>
        <input type="text" name="{{ user_form.username.name }}" id="{{ user_form.username.id_for_label }}" class="form-control" autofocus value="{{ user_form.username.value }}">

        {% for error in user_form.username.errors %}
          <div class="text-danger">{{ error }}</div>
        {% endfor %}
      </div>
    </fieldset>

    <fieldset class="mb-4">
      <legend>Аватар</legend>
      
      {% if profile_form.instance.avatar %}
        <div class="profile-avatar-wrapper mb-3">
          {% if user.is_authenticated and user.profile.avatar %}
          <img src="{{ user.profile.avatar.url }}" alt="Аватар" class="profile-avatar" />
          {% else %}
            <img src="https://via.placeholder.com/80" alt="Аватар" />
          {% endif %}
        </div>
      {% endif %}

      <div class="mb-3">
        <label for="{{ profile_form.avatar.id_for_label }}" class="form-label">Загрузить новый аватар</label>
        {{ profile_form.avatar|add_class:"form-control" }}
        {% for error in profile_form.avatar.errors %}
          <div class="text-danger">{{ error }}</div>
        {% endfor %}
      </div>
    </fieldset>

  <fieldset class="mb-4">
    <legend>Смена пароля</legend>
    
    {% if password_form.non_field_errors %}
      <div class="alert alert-danger">
        <ul>
          {% for error in password_form.non_field_errors %}
            <li>{{ error }}</li>
          {% endfor %}
        </ul>
      </div>
    {% endif %}

    <div class="mb-3">
      <label for="{{ password_form.old_password.id_for_label }}" class="form-label">Старый пароль</label>
      {{ password_form.old_password|add_class:"form-control" }}
      {% for error in password_form.old_password.errors %}
        <div class="text-danger">{{ error }}</div>
      {% endfor %}
    </div>

    <div class="mb-3">
      <label for="{{ password_form.new_password1.id_for_label }}" class="form-label">Новый пароль</label>
      {{ password_form.new_password1|add_class:"form-control" }}
      {% for error in password_form.new_password1.errors %}
        <div class="text-danger">{{ error }}</div>
      {% endfor %}
    </div>

    <div class="mb-3">
      <label for="{{ password_form.new_password2.id_for_label }}" class="form-label">Подтвердите новый пароль</label>
      {{ password_form.new_password2|add_class:"form-control" }}
      {% for error in password_form.new_password2.errors %}
        <div class="text-danger">{{ error }}</div>
      {% endfor %}
    </div>
  </fieldset>


    <button type="submit" class="btn btn-custom">Сохранить изменения</button>
  </form>
</div>
{% endblock %}
