{% extends "base.html" %}
<!-- {% load static %} -->
{% block content %}
<style>
  .pomodoro-container {
    max-width: 400px;
    margin: 40px auto; /* Центр по горизонтали и отступ сверху/снизу */
    text-align: center;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  .pomodoro-container img {
    margin-bottom: 20px;
  }
  .btn-group {
    margin-bottom: 30px;
  }
  #timer-display {
    font-size: 3rem;
    margin-bottom: 30px;
  }
  .controls {
    margin-bottom: 40px;
  }
  .controls button {
    margin: 0 10px;
  }
  h2 {
    margin-bottom: 20px;
  }
</style>

<div class="pomodoro-container">
  <img src="{% static 'time.png' %}" alt="Пример картинки" width="100" height="100"/>

  <div class="btn-group mb-3" role="group" aria-label="Выбор времени">
    <button class="btn btn-outline-custom timer-btn" data-minutes="1">1 минут</button>
    <button class="btn btn-outline-custom timer-btn" data-minutes="15">15 минут</button>
    <button class="btn btn-outline-custom timer-btn" data-minutes="30">30 минут</button>
    <button class="btn btn-outline-custom timer-btn" data-minutes="60">60 минут</button>
  </div>

  <h3 id="timer-display">00:00</h3>

  <div class="controls">
    <button id="start-btn" class="btn btn-success" disabled>Старт</button>
    <button id="stop-btn" class="btn btn-danger" disabled>Стоп</button>
    <button id="reset-btn" class="btn btn-secondary" disabled>Сброс</button>
  </div>

  <h2>Помодоро Таймер</h2>
      <h6>Сделай сейчас — поблагодаришь себя потом.</p>

  <audio id="alarm-sound" src="{% static 'love_alarm.mp3' %}" preload="auto"></audio>
</div>

<script>
  const timerDisplay = document.getElementById('timer-display');
  const startBtn = document.getElementById('start-btn');
  const stopBtn = document.getElementById('stop-btn');
  const resetBtn = document.getElementById('reset-btn');
  const alarmSound = document.getElementById('alarm-sound');
  const timerButtons = document.querySelectorAll('.timer-btn');

  let timerDuration = 0; // в секундах
  let remainingTime = 0;
  let timerInterval = null;

  function formatTime(seconds) {
    const m = Math.floor(seconds / 60).toString().padStart(2, '0');
    const s = (seconds % 60).toString().padStart(2, '0');
    return `${m}:${s}`;
  }

  function updateDisplay(time) {
    timerDisplay.textContent = formatTime(time);
  }

  function enableControls() {
    startBtn.disabled = false;
    stopBtn.disabled = true;
    resetBtn.disabled = false;
  }

  function disableControls() {
    startBtn.disabled = true;
    stopBtn.disabled = true;
    resetBtn.disabled = true;
  }

  timerButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      timerDuration = parseInt(btn.dataset.minutes) * 60;
      remainingTime = timerDuration;
      updateDisplay(remainingTime);
      enableControls();

      // Подсветка выбранной кнопки
      timerButtons.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
    });
  });

  startBtn.addEventListener('click', () => {
    startBtn.disabled = true;
    stopBtn.disabled = false;
    resetBtn.disabled = false;

    timerInterval = setInterval(() => {
      remainingTime--;
      updateDisplay(remainingTime);

      if (remainingTime <= 0) {
        clearInterval(timerInterval);
        alarmSound.play();
        disableControls();
      }
    }, 1000);
  });

  stopBtn.addEventListener('click', () => {
    clearInterval(timerInterval);
    startBtn.disabled = false;
    stopBtn.disabled = true;
  });

  resetBtn.addEventListener('click', () => {
    clearInterval(timerInterval);
    remainingTime = timerDuration;
    updateDisplay(remainingTime);
    startBtn.disabled = false;
    stopBtn.disabled = true;
  });
</script>

{% endblock %}
